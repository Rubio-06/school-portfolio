---
import { experienceConfig } from "@config/experience";
import Title from "@ui/Title.astro";

const sortedExperience = [...experienceConfig.items].sort((a, b) => {
  if (a.current) return -1;
  if (b.current) return 1;
  return parseInt(b.startDate) - parseInt(a.startDate);
});
---

<section id="experience" data-experience-section class="relative px-8 py-20">
  <div class="container mx-auto max-w-5xl">
    <!-- Section Title -->
    <div data-experience-header>
      <Title highlight="Expériences" subtitle="Mon expérience académique et professionnelle" />
    </div>

    <!-- Timeline -->
    <div class="relative">
      <!-- Vertical line -->
      <div
        class="absolute top-0 left-8 h-full w-0.5 bg-gradient-to-b from-blue-500 via-purple-500 to-pink-500 opacity-30 md:left-1/2 md:-translate-x-1/2"
      >
      </div>

      <!-- Experience items -->
      <div class="space-y-12">
        {
          sortedExperience.map((item, index) => {
            const isEven = index % 2 === 0;
            const isEducation = item.type === "education";

            return (
              <div
                data-experience-item
                data-item-index={index}
                class:list={[
                  "relative flex gap-8 md:gap-12",
                  isEven ? "md:flex-row" : "md:flex-row-reverse",
                ]}
              >
                {/* Timeline dot */}
                <div class="absolute top-6 left-8 z-10 md:left-1/2 md:-translate-x-1/2">
                  <div
                    class={`flex h-4 w-4 items-center justify-center rounded-full bg-gradient-to-r ${
                      isEducation ? "from-blue-500 to-purple-500" : "from-green-500 to-emerald-500"
                    } shadow-lg`}
                  >
                    <div class="h-2 w-2 rounded-full bg-white" />
                  </div>
                </div>

                {/* Content */}
                <div
                  class:list={[
                    "ml-16 w-full md:ml-0 md:w-[calc(50%-2rem)]",
                    isEven ? "md:text-right" : "md:text-left",
                  ]}
                >
                  <div class="rounded-2xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm transition-all duration-300 hover:border-white/20 hover:bg-white/10">
                    {/* Badge */}
                    {item.current && (
                      <span class="mb-3 inline-block rounded-full bg-gradient-to-r from-blue-500 to-purple-500 px-3 py-1 text-xs font-semibold text-white">
                        En cours
                      </span>
                    )}

                    {/* Date */}
                    <div class="mb-2 flex items-center gap-2 text-sm text-gray-400">
                      <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                        />
                      </svg>
                      <span>
                        {item.startDate}
                        {item.endDate ? ` - ${item.endDate}` : " - Aujourd'hui"}
                      </span>
                    </div>

                    {/* Title */}
                    <h3 class="mb-2 text-xl font-bold text-white md:text-2xl">{item.title}</h3>

                    {/* Organization */}
                    <div class="mb-3 flex items-center gap-2 text-gray-300">
                      <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
                        />
                      </svg>
                      <span>{item.organization}</span>
                      <span class="text-gray-500">•</span>
                      <span class="text-gray-400">{item.location}</span>
                    </div>

                    {/* Description */}
                    <div class="mb-4 space-y-2">
                      {item.description.map((desc) => (
                        <p class="text-sm leading-relaxed text-gray-400">{desc}</p>
                      ))}
                    </div>

                    {/* Skills */}
                    {item.skills && item.skills.length > 0 && (
                      <div class="flex flex-wrap gap-2">
                        {item.skills.map((skill) => (
                          <span class="rounded-lg border border-white/10 bg-white/5 px-3 py-1 text-xs text-gray-300">
                            {skill}
                          </span>
                        ))}
                      </div>
                    )}
                  </div>
                </div>

                {/* Spacer for the other side on desktop */}
                <div class="hidden w-[calc(50%-2rem)] md:block" />
              </div>
            );
          })
        }
      </div>
    </div>
  </div>
</section>

<script>
  import { initExperienceAnimations } from "@animations/experience";

  document.addEventListener("astro:page-load", () => {
    initExperienceAnimations();
  });
</script>
