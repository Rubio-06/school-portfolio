---
export interface Props {
  texts: string[];
  typeSpeed?: number;
  deleteSpeed?: number;
  pauseDuration?: number;
  className?: string;
}

const {
  texts,
  typeSpeed = 0.08,
  deleteSpeed = 0.05,
  pauseDuration = 2,
  className = "",
} = Astro.props;
---

<div class="relative inline-block">
  <span data-typewriter-text class={className}></span>
  <span data-typewriter-cursor class="ml-0.5 font-bold text-blue-400">|</span>
</div>

<script>
  import { gsap } from "gsap";

  const textElement = document.querySelector("[data-typewriter-text]");
  const cursorElement = document.querySelector("[data-typewriter-cursor]");

  if (textElement && cursorElement) {
    // Get texts from data attribute
    const textsAttr = textElement.getAttribute("data-texts");
    const texts = textsAttr ? JSON.parse(textsAttr) : [];

    let currentIndex = 0;
    let isDeleting = false;

    // Cursor blink animation
    gsap.to(cursorElement, {
      opacity: 0,
      duration: 0.5,
      repeat: -1,
      yoyo: true,
      ease: "power1.inOut",
    });

    const typeWriter = () => {
      const currentText = texts[currentIndex];
      const displayedText = textElement.textContent || "";

      if (!isDeleting) {
        // Typing
        if (displayedText.length < currentText.length) {
          textElement.textContent = currentText.substring(0, displayedText.length + 1);
          gsap.delayedCall(0.08, typeWriter);
        } else {
          // Pause before deleting
          gsap.delayedCall(2, () => {
            isDeleting = true;
            typeWriter();
          });
        }
      } else {
        // Deleting
        if (displayedText.length > 0) {
          textElement.textContent = currentText.substring(0, displayedText.length - 1);
          gsap.delayedCall(0.05, typeWriter);
        } else {
          // Move to next text
          isDeleting = false;
          currentIndex = (currentIndex + 1) % texts.length;
          gsap.delayedCall(0.5, typeWriter);
        }
      }
    };

    // Start typing
    if (texts.length > 0) {
      typeWriter();
    }
  }
</script>
