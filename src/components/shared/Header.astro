---
import Social from "@shared/Social.astro";
import { navigation } from "@config/navigation";

const currentPath = Astro.url.pathname;
---

<header class="fixed top-0 z-50 w-full border-b border-white/10 bg-slate-900/80 backdrop-blur-lg">
  <nav class="container mx-auto flex items-center justify-between px-4 py-4 md:px-8">
    <div class="group">
      <a
        href="/"
        class="bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-xl font-bold text-white md:text-2xl"
      >
        Rubio Abela
      </a>
    </div>

    <!-- Menu hamburger pour mobile -->
    <button
      id="mobile-menu-button"
      class="flex flex-col gap-1.5 p-2 md:hidden"
      aria-label="Toggle menu"
    >
      <span class="h-0.5 w-6 bg-white transition-all duration-300"></span>
      <span class="h-0.5 w-6 bg-white transition-all duration-300"></span>
      <span class="h-0.5 w-6 bg-white transition-all duration-300"></span>
    </button>

    <!-- Menu desktop -->
    <div class="hidden items-center gap-12 md:flex">
      <ul class="flex items-center gap-8">
        {
          navigation.map((group, groupIndex) => (
            <>
              <div class="flex items-center gap-6">
                {group.items.map((item) => {
                  const isActive =
                    currentPath === item.href ||
                    (item.href !== "/" && currentPath.startsWith(item.href));
                  const sectionId = item.href.includes("#") ? item.href.split("#")[1] : null;
                  return (
                    <li class="relative">
                      <a
                        href={item.href}
                        data-nav-link
                        data-section={sectionId}
                        class:list={[
                          "relative block px-3 py-2 text-sm font-medium transition-colors",
                          isActive ? "active text-white" : "text-gray-400",
                        ]}
                      >
                        {item.title}
                        <span
                          data-underline
                          class:list={[
                            "absolute bottom-0 left-0 h-0.5 bg-gradient-to-r from-blue-400 to-purple-500 transition-all",
                            isActive ? "w-full" : "w-0",
                          ]}
                        />
                      </a>
                    </li>
                  );
                })}
              </div>
              {groupIndex < navigation.length - 1 && (
                <li class="h-6 w-px bg-gradient-to-b from-transparent via-white/20 to-transparent" />
              )}
            </>
          ))
        }
      </ul>

      <div class="flex items-center gap-4 border-l border-white/10 pl-8">
        <Social />
      </div>
    </div>

    <!-- Menu mobile -->
    <div
      id="mobile-menu"
      class="fixed inset-x-0 top-[73px] h-0 overflow-hidden bg-slate-900/95 backdrop-blur-lg transition-all duration-300 md:hidden"
    >
      <div class="container mx-auto flex flex-col gap-6 px-4 py-6">
        {
          navigation.map((group, groupIndex) => (
            <div class="flex flex-col gap-4">
              {group.items.map((item) => {
                const isActive =
                  currentPath === item.href ||
                  (item.href !== "/" && currentPath.startsWith(item.href));
                const sectionId = item.href.includes("#") ? item.href.split("#")[1] : null;
                return (
                  <a
                    href={item.href}
                    data-mobile-nav-link
                    data-section={sectionId}
                    class:list={[
                      "block px-4 py-3 text-base font-medium transition-colors",
                      isActive ? "text-white" : "text-gray-400",
                    ]}
                  >
                    <span class="flex items-center gap-3">
                      <span
                        data-mobile-indicator
                        class:list={[
                          "h-1.5 w-1.5 rounded-full bg-gradient-to-r from-blue-400 to-purple-500 transition-opacity",
                          isActive ? "opacity-100" : "opacity-0",
                        ]}
                      />
                      {item.title}
                    </span>
                  </a>
                );
              })}
              {groupIndex < navigation.length - 1 && (
                <div class="h-px bg-gradient-to-r from-transparent via-white/10 to-transparent" />
              )}
            </div>
          ))
        }
        <div class="mt-4 flex items-center justify-center gap-4 border-t border-white/10 pt-6">
          <Social />
        </div>
      </div>
    </div>
  </nav>
</header>

<div class="h-[73px]"></div>

<script>
  import { initHeaderAnimations } from "@animations/index";

  document.addEventListener("astro:page-load", () => {
    initHeaderAnimations();
  });
</script>
